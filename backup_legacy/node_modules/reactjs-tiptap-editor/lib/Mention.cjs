"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const c=require("./index-ByRfqzMr.cjs"),T=require("./index-BI-IcZcN.cjs"),g=require("./dom-dataset-Byuf1YmW.cjs"),v=require("tippy.js"),h=require("react/jsx-runtime"),m=require("react"),M=require("scroll-into-view-if-needed");function L({editor:e,overrideSuggestionOptions:n,extensionName:t,char:r="@"}){const i=new c.PluginKey;return{editor:e,char:r,pluginKey:i,command:({editor:o,range:l,props:u})=>{var a,s,d;const f=o.view.state.selection.$to.nodeAfter;((a=f==null?void 0:f.text)===null||a===void 0?void 0:a.startsWith(" "))&&(l.to+=1),o.chain().focus().insertContentAt(l,[{type:t,attrs:{...u,mentionSuggestionChar:r}},{type:"text",text:" "}]).run(),(d=(s=o.view.dom.ownerDocument.defaultView)===null||s===void 0?void 0:s.getSelection())===null||d===void 0||d.collapseToEnd()},allow:({state:o,range:l})=>{const u=o.doc.resolve(l.from),a=o.schema.nodes[t];return!!u.parent.type.contentMatch.matchType(a)},...n}}function y(e){return(e.options.suggestions.length?e.options.suggestions:[e.options.suggestion]).map(n=>L({editor:e.editor,overrideSuggestionOptions:n,extensionName:e.name,char:n.char}))}function b(e,n){const t=y(e),r=t.find(i=>i.char===n);return r||(t.length?t[0]:null)}const w=c.Node.create({name:"mention",priority:101,addOptions(){return{HTMLAttributes:{},renderText({node:e,suggestion:n}){var t,r;return`${(t=n==null?void 0:n.char)!==null&&t!==void 0?t:"@"}${(r=e.attrs.label)!==null&&r!==void 0?r:e.attrs.id}`},deleteTriggerWithBackspace:!1,renderHTML({options:e,node:n,suggestion:t}){var r,i;return["span",c.mergeAttributes(this.HTMLAttributes,e.HTMLAttributes),`${(r=t==null?void 0:t.char)!==null&&r!==void 0?r:"@"}${(i=n.attrs.label)!==null&&i!==void 0?i:n.attrs.id}`]},suggestions:[],suggestion:{}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:e=>e.getAttribute("data-id"),renderHTML:e=>e.id?{"data-id":e.id}:{}},label:{default:null,parseHTML:e=>e.getAttribute("data-label"),renderHTML:e=>e.label?{"data-label":e.label}:{}},mentionSuggestionChar:{default:"@",parseHTML:e=>e.getAttribute("data-mention-suggestion-char"),renderHTML:e=>({"data-mention-suggestion-char":e.mentionSuggestionChar})}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:e,HTMLAttributes:n}){const t=b(this,e.attrs.mentionSuggestionChar);if(this.options.renderLabel!==void 0)return console.warn("renderLabel is deprecated use renderText and renderHTML instead"),["span",c.mergeAttributes({"data-type":this.name},this.options.HTMLAttributes,n),this.options.renderLabel({options:this.options,node:e,suggestion:t})];const r={...this.options};r.HTMLAttributes=c.mergeAttributes({"data-type":this.name},this.options.HTMLAttributes,n);const i=this.options.renderHTML({options:r,node:e,suggestion:t});return typeof i=="string"?["span",c.mergeAttributes({"data-type":this.name},this.options.HTMLAttributes,n),i]:i},renderText({node:e}){const n={options:this.options,node:e,suggestion:b(this,e.attrs.mentionSuggestionChar)};return this.options.renderLabel!==void 0?(console.warn("renderLabel is deprecated use renderText and renderHTML instead"),this.options.renderLabel(n)):this.options.renderText(n)},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:e,state:n})=>{let t=!1;const{selection:r}=n,{empty:i,anchor:o}=r;if(!i)return!1;n.doc.nodesBetween(o-1,o,(a,s)=>{if(a.type.name===this.name)return t=!0,e.insertText(this.options.deleteTriggerWithBackspace?"":this.options.suggestion.char||"",s,s+a.nodeSize),!1});let l=new c.Node$1,u=0;return n.doc.nodesBetween(o-1,o,(a,s)=>{if(a.type.name===this.name)return t=!0,l=a,u=s,!1}),t&&e.insertText(this.options.deleteTriggerWithBackspace?"":l.attrs.mentionSuggestionChar,u,u+l.nodeSize),t})}},addProseMirrorPlugins(){return y(this).map(T.Suggestion)}}),S="_listUsers_en3pm_1",H="_itemUser_en3pm_10",A="_selectedUser_en3pm_31",p={listUsers:S,itemUser:H,selectedUser:A},x=m.forwardRef((e,n)=>{const t=m.useRef(null),[r,i]=m.useState(0),o=s=>{const d=e.items[s];d&&e.command({id:d,label:d})},l=()=>{i((r+e.items.length-1)%e.items.length)},u=()=>{i((r+1)%e.items.length)},a=()=>{o(r)};return m.useEffect(()=>i(0),[e.items]),m.useEffect(()=>{if(Number.isNaN(r+1))return;const s=t.current.querySelector(`span:nth-of-type(${r+1})`);s&&M(s,{behavior:"smooth",scrollMode:"if-needed"})},[r]),m.useImperativeHandle(n,()=>({onKeyDown:({event:s})=>s.key==="ArrowUp"?(l(),!0):s.key==="ArrowDown"?(u(),!0):s.key==="Enter"?(a(),!0):!1})),h.jsx("div",{className:g.clsx("listUsers",p.listUsers),children:h.jsx("div",{ref:t,children:e.items.length>0?e.items.map((s,d)=>h.jsx("span",{className:g.clsx("itemUser",p.itemUser,d===r?p.selectedUser:""),onClick:()=>o(d),children:s},d)):h.jsx("div",{className:g.clsx("itemUserEmpty",p.itemUser),children:"Empty"})})})}),U=[{id:"1",name:"John Doe"},{id:"2",name:"Jane Doe"},{id:"3",name:"Alice"},{id:"4",name:"Bob"}],_={items:async({query:e})=>U.map(t=>t.name).filter(t=>t.toLowerCase().startsWith(e.toLowerCase())),render:()=>{let e,n;return{onStart:t=>{e=new g.ReactRenderer(x,{props:t,editor:t.editor}),n=v("body",{getReferenceClientRect:t.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"})},onUpdate(t){e.updateProps(t),n[0].setProps({getReferenceClientRect:t.clientRect})},onKeyDown(t){var r;return t.event.key==="Escape"?(n[0].hide(),!0):(r=e.ref)==null?void 0:r.onKeyDown(t)},onExit(){n[0].destroy(),e.destroy()}}}},C=w.extend({addAttributes(){return{id:{default:"",parseHTML:g.getDatasetAttribute("id")},label:{default:"",parseHTML:g.getDatasetAttribute("label")}}}}).configure({HTMLAttributes:{class:"mention"},suggestion:_});exports.Mention=C;
