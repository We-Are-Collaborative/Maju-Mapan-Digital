"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const x=require("./index-ByRfqzMr.cjs"),g=require("react/jsx-runtime"),M=require("./RichTextEditor-DWlLqTl9.cjs");var C=200,f=function(){};f.prototype.append=function(e){return e.length?(e=f.from(e),!this.length&&e||e.length<C&&this.leafAppend(e)||this.length<C&&e.leafPrepend(this)||this.appendInner(e)):this};f.prototype.prepend=function(e){return e.length?f.from(e).append(this):this};f.prototype.appendInner=function(e){return new _(this,e)};f.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.length),e>=t?f.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))};f.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};f.prototype.forEach=function(e,t,n){t===void 0&&(t=0),n===void 0&&(n=this.length),t<=n?this.forEachInner(e,t,n,0):this.forEachInvertedInner(e,t,n,0)};f.prototype.map=function(e,t,n){t===void 0&&(t=0),n===void 0&&(n=this.length);var i=[];return this.forEach(function(s,l){return i.push(e(s,l))},t,n),i};f.from=function(e){return e instanceof f?e:e&&e.length?new A(e):f.empty};var A=function(r){function e(n){r.call(this),this.values=n}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,s){return i==0&&s==this.length?this:new e(this.values.slice(i,s))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,s,l,o){for(var p=s;p<l;p++)if(i(this.values[p],o+p)===!1)return!1},e.prototype.forEachInvertedInner=function(i,s,l,o){for(var p=s-1;p>=l;p--)if(i(this.values[p],o+p)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=C)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=C)return new e(i.flatten().concat(this.values))},t.length.get=function(){return this.values.length},t.depth.get=function(){return 0},Object.defineProperties(e.prototype,t),e}(f);f.empty=new A([]);var _=function(r){function e(t,n){r.call(this),this.left=t,this.right=n,this.length=t.length+n.length,this.depth=Math.max(t.depth,n.depth)+1}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(n){return n<this.left.length?this.left.get(n):this.right.get(n-this.left.length)},e.prototype.forEachInner=function(n,i,s,l){var o=this.left.length;if(i<o&&this.left.forEachInner(n,i,Math.min(s,o),l)===!1||s>o&&this.right.forEachInner(n,Math.max(i-o,0),Math.min(this.length,s)-o,l+o)===!1)return!1},e.prototype.forEachInvertedInner=function(n,i,s,l){var o=this.left.length;if(i>o&&this.right.forEachInvertedInner(n,i-o,Math.max(s,o)-o,l+o)===!1||s<o&&this.left.forEachInvertedInner(n,Math.min(i,o),s,l)===!1)return!1},e.prototype.sliceInner=function(n,i){if(n==0&&i==this.length)return this;var s=this.left.length;return i<=s?this.left.slice(n,i):n>=s?this.right.slice(n-s,i-s):this.left.slice(n,s).append(this.right.slice(0,i-s))},e.prototype.leafAppend=function(n){var i=this.right.leafAppend(n);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(n){var i=this.left.leafPrepend(n);if(i)return new e(i,this.right)},e.prototype.appendInner=function(n){return this.left.depth>=Math.max(this.right.depth,n.depth)+1?new e(this.left,new e(this.right,n)):new e(this,n)},e}(f);const L=500;class m{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(this.eventCount==0)return null;let n=this.items.length;for(;;n--)if(this.items.get(n-1).selection){--n;break}let i,s;t&&(i=this.remapping(n,this.items.length),s=i.maps.length);let l=e.tr,o,p,a=[],c=[];return this.items.forEach((u,h)=>{if(!u.step){i||(i=this.remapping(n,h+1),s=i.maps.length),s--,c.push(u);return}if(i){c.push(new v(u.map));let d=u.step.map(i.slice(s)),w;d&&l.maybeStep(d).doc&&(w=l.mapping.maps[l.mapping.maps.length-1],a.push(new v(w,void 0,void 0,a.length+c.length))),s--,w&&i.appendMap(w,s)}else l.maybeStep(u.step);if(u.selection)return o=i?u.selection.map(i.slice(s)):u.selection,p=new m(this.items.slice(0,n).append(c.reverse().concat(a)),this.eventCount-1),!1},this.items.length,0),{remaining:p,transform:l,selection:o}}addTransform(e,t,n,i){let s=[],l=this.eventCount,o=this.items,p=!i&&o.length?o.get(o.length-1):null;for(let c=0;c<e.steps.length;c++){let u=e.steps[c].invert(e.docs[c]),h=new v(e.mapping.maps[c],u,t),d;(d=p&&p.merge(h))&&(h=d,c?s.pop():o=o.slice(0,o.length-1)),s.push(h),t&&(l++,t=void 0),i||(p=h)}let a=l-n.depth;return a>G&&(o=S(o,a),l-=a),new m(o.append(s),l)}remapping(e,t){let n=new x.Mapping;return this.items.forEach((i,s)=>{let l=i.mirrorOffset!=null&&s-i.mirrorOffset>=e?n.maps.length-i.mirrorOffset:void 0;n.appendMap(i.map,l)},e,t),n}addMaps(e){return this.eventCount==0?this:new m(this.items.append(e.map(t=>new v(t))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let n=[],i=Math.max(0,this.items.length-t),s=e.mapping,l=e.steps.length,o=this.eventCount;this.items.forEach(h=>{h.selection&&o--},i);let p=t;this.items.forEach(h=>{let d=s.getMirror(--p);if(d==null)return;l=Math.min(l,d);let w=s.maps[d];if(h.step){let D=e.steps[d].invert(e.docs[d]),b=h.selection&&h.selection.map(s.slice(p+1,d));b&&o++,n.push(new v(w,D,b))}else n.push(new v(w))},i);let a=[];for(let h=t;h<l;h++)a.push(new v(s.maps[h]));let c=this.items.slice(0,i).append(a).append(n),u=new m(c,o);return u.emptyItemCount()>L&&(u=u.compress(this.items.length-n.length)),u}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),n=t.maps.length,i=[],s=0;return this.items.forEach((l,o)=>{if(o>=e)i.push(l),l.selection&&s++;else if(l.step){let p=l.step.map(t.slice(n)),a=p&&p.getMap();if(n--,a&&t.appendMap(a,n),p){let c=l.selection&&l.selection.map(t.slice(n));c&&s++;let u=new v(a.invert(),p,c),h,d=i.length-1;(h=i.length&&i[d].merge(u))?i[d]=h:i.push(u)}}else l.map&&n--},this.items.length,0),new m(f.from(i.reverse()),s)}}m.empty=new m(f.empty,0);function S(r,e){let t;return r.forEach((n,i)=>{if(n.selection&&e--==0)return t=i,!1}),r.slice(t)}class v{constructor(e,t,n,i){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new v(t.getMap().invert(),t,this.selection)}}}class y{constructor(e,t,n,i,s){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=i,this.prevComposition=s}}const G=20;function F(r,e,t,n){let i=t.getMeta(I),s;if(i)return i.historyState;t.getMeta(R)&&(r=new y(r.done,r.undone,null,0,-1));let l=t.getMeta("appendedTransaction");if(t.steps.length==0)return r;if(l&&l.getMeta(I))return l.getMeta(I).redo?new y(r.done.addTransform(t,void 0,n,E(e)),r.undone,O(t.mapping.maps),r.prevTime,r.prevComposition):new y(r.done,r.undone.addTransform(t,void 0,n,E(e)),null,r.prevTime,r.prevComposition);if(t.getMeta("addToHistory")!==!1&&!(l&&l.getMeta("addToHistory")===!1)){let o=t.getMeta("composition"),p=r.prevTime==0||!l&&r.prevComposition!=o&&(r.prevTime<(t.time||0)-n.newGroupDelay||!z(t,r.prevRanges)),a=l?T(r.prevRanges,t.mapping):O(t.mapping.maps);return new y(r.done.addTransform(t,p?e.selection.getBookmark():void 0,n,E(e)),m.empty,a,t.time,o??r.prevComposition)}else return(s=t.getMeta("rebased"))?new y(r.done.rebased(t,s),r.undone.rebased(t,s),T(r.prevRanges,t.mapping),r.prevTime,r.prevComposition):new y(r.done.addMaps(t.mapping.maps),r.undone.addMaps(t.mapping.maps),T(r.prevRanges,t.mapping),r.prevTime,r.prevComposition)}function z(r,e){if(!e)return!1;if(!r.docChanged)return!0;let t=!1;return r.mapping.maps[0].forEach((n,i)=>{for(let s=0;s<e.length;s+=2)n<=e[s+1]&&i>=e[s]&&(t=!0)}),t}function O(r){let e=[];for(let t=r.length-1;t>=0&&e.length==0;t--)r[t].forEach((n,i,s,l)=>e.push(s,l));return e}function T(r,e){if(!r)return null;let t=[];for(let n=0;n<r.length;n+=2){let i=e.map(r[n],1),s=e.map(r[n+1],-1);i<=s&&t.push(i,s)}return t}function N(r,e,t){let n=E(e),i=I.get(e).spec.config,s=(t?r.undone:r.done).popEvent(e,n);if(!s)return null;let l=s.selection.resolve(s.transform.doc),o=(t?r.done:r.undone).addTransform(s.transform,e.selection.getBookmark(),i,n),p=new y(t?o:s.remaining,t?s.remaining:o,null,0,-1);return s.transform.setSelection(l).setMeta(I,{redo:t,historyState:p})}let P=!1,j=null;function E(r){let e=r.plugins;if(j!=e){P=!1,j=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){P=!0;break}}return P}const I=new x.PluginKey("history"),R=new x.PluginKey("closeHistory");function U(r={}){return r={depth:r.depth||100,newGroupDelay:r.newGroupDelay||500},new x.Plugin({key:I,state:{init(){return new y(m.empty,m.empty,null,0,-1)},apply(e,t,n){return F(t,n,e,r)}},config:r,props:{handleDOMEvents:{beforeinput(e,t){let n=t.inputType,i=n=="historyUndo"?K:n=="historyRedo"?k:null;return i?(t.preventDefault(),i(e.state,e.dispatch)):!1}}}})}function H(r,e){return(t,n)=>{let i=I.getState(t);if(!i||(r?i.undone:i.done).eventCount==0)return!1;if(n){let s=N(i,t,r);s&&n(e?s.scrollIntoView():s)}return!0}}const K=H(!1,!0),k=H(!0,!0),Z=x.Extension.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:r,dispatch:e})=>K(r,e),redo:()=>({state:r,dispatch:e})=>k(r,e)}},addProseMirrorPlugins(){return[U(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}});function $(r){var a;const{icon:e=void 0,tooltip:t=void 0,customClass:n="",tooltipOptions:i={},action:s=void 0,isActive:l=void 0,children:o}=r,p=M.icons[e];return g.jsxs(M.Tooltip,{children:[g.jsx(M.TooltipTrigger,{asChild:!0,children:g.jsxs(M.Toggle,{size:"sm",className:`richtext-w-[32px] richtext-h-[32px] ${n}`,disabled:l==null?void 0:l(),onClick:s,children:[p&&g.jsx(p,{className:"richtext-w-4 richtext-h-4"}),o&&g.jsx(g.Fragment,{children:o})]})}),t&&g.jsx(M.TooltipContent,{...i,children:g.jsxs("div",{className:"richtext-flex richtext-flex-col richtext-items-center richtext-text-center richtext-max-w-24",children:[g.jsx("div",{children:t}),!!((a=r==null?void 0:r.shortcutKeys)!=null&&a.length)&&g.jsx("span",{children:M.getShortcutKeys(r==null?void 0:r.shortcutKeys)})]})})]})}const V=["undo","redo"],W=Z.extend({addOptions(){var r;return{...(r=this.parent)==null?void 0:r.call(this),depth:100,newGroupDelay:500,button:({editor:e,t,extension:n})=>V.map(i=>{var s,l;return{component:$,componentProps:{action:()=>{i==="undo"&&e.chain().focus().undo().run(),i==="redo"&&e.chain().focus().redo().run()},shortcutKeys:i==="undo"?((s=n.options.shortcutKeys)==null?void 0:s[0])??["mod","Z"]:((l=n.options.shortcutKeys)==null?void 0:l[1])??["shift","mod","Z"],disabled:i==="undo"?!e.can().undo():!e.can().redo(),isActive:()=>i==="undo"?!e.can().undo():!e.can().redo(),icon:i==="undo"?"Undo2":"Redo2",tooltip:t(`editor.${i}.tooltip`)}}})}}});exports.History=W;
