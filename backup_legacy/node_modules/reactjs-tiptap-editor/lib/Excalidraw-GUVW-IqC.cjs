"use strict";var W=Object.create;var N=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var q=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty;var P=(e,t,c,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let l of Z(t))!z.call(e,l)&&l!==c&&N(e,l,{get:()=>t[l],enumerable:!(o=H(t,l))||o.enumerable});return e};var y=(e,t,c)=>(c=e!=null?W(q(e)):{},P(t||!e||!e.__esModule?N(c,"default",{value:e,enumerable:!0}):c,e));const L=require("./index-ByRfqzMr.cjs"),g=require("./dom-dataset-Byuf1YmW.cjs"),n=require("react/jsx-runtime"),r=require("react"),h=require("./RichTextEditor-DWlLqTl9.cjs"),B=require("./index-D_A0TBRA.cjs"),V=require("re-resizable");let M;function I(){try{return M||(M=B.mitt()),M}catch{throw new Error("Error EventEmitter")}}const D="OPEN_EXCALIDRAW_SETTING_MODAL";function $(e,t){I().on(e,t)}function U(e,t){I().off(e,t)}function X(e){I().emit(D,e)}const F=({editor:e,tooltipOptions:t})=>{const c=r.useMemo(()=>{var a;return((a=e.extensionManager.extensions.find(i=>i.name==="excalidraw"))==null?void 0:a.options)||{}},[e]),[o,l]=r.useState(null),[d,x]=r.useState({}),[b,f]=r.useState({elements:[],appState:{isLoading:!1},files:null}),[E,u]=r.useState(!1),[w,p]=r.useState(!0),[m,j]=r.useState(null),T=r.useCallback(a=>{a&&import("@excalidraw/excalidraw").then(i=>{l(i.Excalidraw)}).catch(j).finally(()=>p(!1))},[p]),v=r.useCallback(a=>{setTimeout(()=>{a.refresh()})},[]),_=r.useCallback((a,i,A)=>{x({elements:a,appState:{isLoading:!1},files:A})},[]),s=r.useCallback(()=>{if(!o){u(!1);return}e.chain().focus().setExcalidraw({data:d}).run(),u(!1)},[o,e,d,u]);return r.useEffect(()=>{const a=i=>{(i==null?void 0:i.editor)===e&&(u(!0),i&&f(i.data))};return $(D,a),()=>{U(D,a)}},[e,u]),r.useEffect(()=>{!w&&o&&E&&setTimeout(()=>{window.dispatchEvent(new Event("resize"))},400)},[w,o,E]),n.jsxs(h.Dialog,{onOpenChange:u,open:E,children:[n.jsx(h.DialogTrigger,{asChild:!0,children:n.jsx(h.ActionButton,{action:()=>u(!0),icon:"Excalidraw",tooltip:"Excalidraw",tooltipOptions:t})}),n.jsxs(h.DialogContent,{className:"richtext-z-[99999] !richtext-max-w-[1300px]",children:[n.jsx(h.DialogTitle,{children:"Excalidraw"}),n.jsxs("div",{style:{height:"100%",borderWidth:1},children:[w&&n.jsx("p",{children:"Loading..."}),m&&n.jsx("p",{children:m&&m.message||"Error"}),n.jsx("div",{ref:T,style:{width:"100%",height:600},children:!w&&!m&&o?n.jsx(o,{initialData:b,langCode:"en",onChange:_,ref:v,...c.excalidrawProps}):null})]}),n.jsx(h.DialogFooter,{children:n.jsx(h.Button,{onClick:s,type:"button",children:"Save changes"})})]})]})},G="_wrap_15k3c_1",Y="_renderWrap_15k3c_7",J="_handlerWrap_15k3c_30",S={wrap:G,renderWrap:Y,handlerWrap:J},K=10,Q=200,C=15,O={width:"100%",height:"100%",maxWidth:"100%"};function ee({editor:e,node:t,updateAttributes:c}){const o=r.useRef(null),l=e.isActive(k.name),{data:d,width:x,height:b}=t.attrs,[f,E]=r.useState(null),[u,w]=r.useState(!0),[p,m]=r.useState(null),[j,T]=r.useState(100),v=r.useCallback(s=>()=>{T(a=>h.clamp(s==="minus"?a-C:a+C,K,Q))},[]);r.useEffect(()=>{let s=!1;return import("@excalidraw/excalidraw").then(a=>{s||(o.current=a.exportToSvg)}).catch(a=>!s&&m(a)).finally(()=>!s&&w(!1)),()=>{s=!0}},[d]),r.useEffect(()=>{let s=!1;return(async()=>{if(!o.current||s||u||p||!d)return;const i=await o.current(d);s||(i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("display","block"),E(i))})(),()=>{s=!0}},[d,u,p]);const _=s=>{c({width:s.width,height:s.height})};return n.jsx(g.NodeViewWrapper,{className:g.clsx(S.wrap,l&&S.isActive),children:n.jsx(V.Resizable,{size:{width:Number.parseInt(x),height:Number.parseInt(b)},onResizeStop:(s,a,i,A)=>{_({width:Number.parseInt(x)+A.width,height:Number.parseInt(b)+A.height})},children:n.jsxs("div",{className:g.clsx(S.renderWrap,"render-wrapper"),style:{...O,overflow:"hidden"},children:[p&&n.jsx("div",{style:O,children:n.jsx("p",{children:p.message||p})}),u&&n.jsx("p",{children:"Loading..."}),!u&&!p&&f&&n.jsx("div",{dangerouslySetInnerHTML:{__html:(f==null?void 0:f.outerHTML)??""},style:{height:"100%",maxHeight:"100%",padding:24,overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center",transform:`scale(${j/100})`,transition:"all ease-in-out .3s"}}),n.jsxs("div",{className:S.handlerWrap,children:[n.jsx(h.ActionButton,{action:v("minus"),icon:"ZoomOut",tooltip:"Zoom Out"}),n.jsx(h.ActionButton,{action:v("plus"),icon:"ZoomIn",tooltip:"Zoom In"})]})]})})})}const R={elements:[]},k=L.Node.create({name:"excalidraw",group:"block",selectable:!0,atom:!0,draggable:!0,inline:!1,addAttributes(){return{defaultShowPicker:{default:!1},createUser:{default:null},width:{default:"100%",parseHTML:g.getDatasetAttribute("width")},height:{default:240,parseHTML:g.getDatasetAttribute("height")},data:{default:R,parseHTML:g.getDatasetAttribute("data",!0)}}},addOptions(){var e;return{...(e=this.parent)==null?void 0:e.call(this),HTMLAttributes:{class:"excalidraw"},excalidrawProps:{},button:({editor:t})=>({component:F,componentProps:{editor:t}})}},parseHTML(){return[{tag:"div[class=excalidraw]"}]},renderHTML({HTMLAttributes:e,node:t}){return["div",L.mergeAttributes(this.options.HTMLAttributes,e,g.nodeAttrsToDataset(t))]},addCommands(){return{setExcalidraw:e=>({tr:t,commands:c,chain:o})=>{var l,d,x;return e=e||{},e.data=e.data||R,((x=(d=(l=t.selection)==null?void 0:l.node)==null?void 0:d.type)==null?void 0:x.name)==this.name?c.updateAttributes(this.name,e):o().insertContent({type:this.name,attrs:e}).run()}}},addNodeView(){return g.ReactNodeViewRenderer(ee)},addInputRules(){return[L.nodeInputRule({find:/^\$excalidraw\$$/,type:this.type,getAttributes:()=>({width:"100%"})})]}});exports.Excalidraw=k;exports.triggerOpenExcalidrawSettingModal=X;
