"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const l=require("./index-ByRfqzMr.cjs"),f=require("./dom-dataset-Byuf1YmW.cjs"),n=require("react/jsx-runtime"),c=require("react"),b=require("katex"),j=require("lucide-react"),u=require("./RichTextEditor-DWlLqTl9.cjs"),w=require("./textarea-DdH64g04.cjs"),k=require("./index-D_A0TBRA.cjs");function $({editor:t,...e}){const{t:s}=k.useLocale(),o=u.useAttributes(t,x.name,{text:"",defaultShowPicker:!1}),{text:a,defaultShowPicker:r}=o,[i,d]=c.useState(""),g=c.useCallback(()=>{t.chain().focus().setKatex({text:i}).run(),d("")},[t,i]);c.useEffect(()=>{r&&t.chain().updateAttributes(x.name,{defaultShowPicker:!1}).focus().run()},[t,r]);const h=c.useMemo(()=>{try{return b.renderToString(`${i}`)}catch{return i}},[i]),m=c.useMemo(()=>`${i}`.trim()?n.jsx("span",{contentEditable:!1,dangerouslySetInnerHTML:{__html:h||""}}):null,[i,h]);return n.jsxs(u.Popover,{modal:!0,children:[n.jsx(u.PopoverTrigger,{asChild:!0,children:n.jsx(u.ActionButton,{icon:e==null?void 0:e.icon,tooltip:e==null?void 0:e.tooltip,tooltipOptions:e==null?void 0:e.tooltipOptions})}),n.jsxs(u.PopoverContent,{align:"start",className:"richtext-size-full richtext-p-2",hideWhenDetached:!0,side:"bottom",children:[n.jsx(u.Label,{className:"richtext-mb-[6px]",children:s("editor.formula.dialog.text")}),n.jsx("div",{className:"richtext-mb-[16px] richtext-flex richtext-w-full richtext-max-w-sm richtext-items-center richtext-gap-1.5",children:n.jsx("div",{className:"richtext-relative richtext-w-full richtext-max-w-sm",children:n.jsx(w.Textarea,{autoFocus:!0,className:"richtext-w-full",defaultValue:a,onChange:p=>d(p.target.value),placeholder:"Text",required:!0,rows:3,value:i})})}),m&&n.jsx("div",{className:"richtext-my-[10px] richtext-max-w-[286px] richtext-overflow-auto richtext-whitespace-nowrap richtext-rounded-[6px] !richtext-border richtext-p-[10px]",children:m}),n.jsxs("div",{className:"richtext-flex richtext-items-center richtext-justify-between richtext-gap-[6px]",children:[n.jsx(u.Button,{className:"richtext-flex-1",onClick:g,children:"Submit"}),n.jsx("a",{href:"https://katex.org/docs/supported",rel:"noreferrer noopener",target:"_blank",children:n.jsx(j.HelpCircle,{size:16})})]})]})]})}function T(t,e=1){let s=0,o=0,a=0;if(t.startsWith("rgb")){const r=t.replace(/\s/g,"").match(/rgb\((.*)\)$/)[1].split(",");s=+r[0],o=+r[1],a=+r[2]}else if(t.startsWith("#")){let r=t.replace("#","");r.length===3&&(r=`${r[0]}${r[0]}${r[1]}${r[1]}${r[2]}${r[2]}`),s=Number.parseInt(r.substring(0,2),16),o=Number.parseInt(r.substring(2,4),16),a=Number.parseInt(r.substring(4,6),16)}else return t;return e>1&&e<=100&&(e=e/100),`rgba(${s},${o},${a},${e})`}function v({node:t}){const e=u.useTheme(),{text:s}=t.attrs,o=c.useMemo(()=>{const i="rgb(254, 242, 237)";return e==="dark"?T(i,.75):i},[e]),a=c.useMemo(()=>{try{return b.renderToString(`${s}`)}catch{return s}},[s]),r=c.useMemo(()=>s.trim()?n.jsx("span",{contentEditable:!1,dangerouslySetInnerHTML:{__html:a}}):n.jsx("span",{contentEditable:!1,children:"Not enter a formula"}),[s,a]);return n.jsx(f.NodeViewWrapper,{style:{display:"inline-block",backgroundColor:o},as:"span",children:r})}function N(t){return e=>e.getAttribute(t)}const x=l.Node.create({name:"katex",group:"inline",inline:!0,defining:!0,draggable:!0,selectable:!0,addOptions(){return{HTMLAttributes:{class:"katex"},button:({editor:t,t:e})=>({component:$,componentProps:{editor:t,action:()=>!0,isActive:()=>!1,disabled:!1,icon:"KatexIcon",tooltip:e("editor.katex.tooltip")}})}},addAttributes(){return{text:{default:"",parseHTML:N("text")},defaultShowPicker:{default:!1}}},parseHTML(){return[{tag:"span.katex"}]},renderHTML({HTMLAttributes:t}){return["span",l.mergeAttributes(this.options&&this.options.HTMLAttributes||{},t)]},addCommands(){return{setKatex:t=>({commands:e})=>e.insertContent({type:this.name,attrs:t})}},addInputRules(){return[l.nodeInputRule({find:/^\$katex\$$/,type:this.type,getAttributes:()=>({defaultShowPicker:!0})})]},addNodeView(){return f.ReactNodeViewRenderer(v)}});exports.Katex=x;
