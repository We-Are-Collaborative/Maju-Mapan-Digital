"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const h=require("./index-ByRfqzMr.cjs"),p=require("./dom-dataset-Byuf1YmW.cjs"),l=require("react/jsx-runtime"),c=require("react"),C=require("./index-D_A0TBRA.cjs"),b=require("./RichTextEditor-DWlLqTl9.cjs"),g="_toc_aag8a_1",x="_visible_aag8a_7",T="_list_aag8a_11",O="_item_aag8a_16",f={toc:g,visible:x,list:T,item:O};function _(e){const s=[],o=[s];return e.forEach(a=>{let t=-1,n=o[a.level+t];for(;!n;)t-=1,n=o[a.level+t];n.push({...a,children:o[a.level]=[]})}),s}function y({editor:e}){const s=b.useEditableEditor(),[o,a]=c.useState([]),{t}=C.useLocale(),n=c.useCallback(()=>{const i=[],r=e.state.tr;e.state.doc.descendants((u,v)=>{if(u.type.name==="heading"){const d=`heading-${i.length+1}`;u.attrs.id!==d&&r.setNodeMarkup(v,void 0,{...u.attrs,id:d}),i.push({level:u.attrs.level,text:u.textContent,id:d})}}),r.setMeta("addToHistory",!1),r.setMeta("preventUpdate",!0),e.view.dispatch(r),a(i),e.eventEmitter&&e.eventEmitter.emit("TableOfContents",_(i))},[e]);return c.useEffect(()=>{if(e){if(!e.options.editable){n();return}return e.on("update",n),()=>{e.off("update",n)}}},[e,n]),c.useEffect(()=>{n()},[]),l.jsx(p.NodeViewWrapper,{className:p.clsx("tableOfContent",f.toc,s&&f.visible),children:s?l.jsxs("div",{style:{position:"relative"},children:[l.jsx("p",{className:"text-[20px] richtext-mb-[8px] richtext-font-semibold",children:t("editor.table_of_content")}),l.jsx("ul",{className:f.list,children:o.map((i,r)=>l.jsx("li",{className:f.item,style:{paddingLeft:`${i.level-1}rem`},children:l.jsx("a",{href:`#${i.id}`,children:i.text})},`table-of-content-${r}`))})]}):null})}function N(e,...s){const[o,a]=c.useState(!1);return c.useEffect(()=>{const t=()=>{a(e.isActive.apply(e,s))};return e.on("selectionUpdate",t),e.on("transaction",t),()=>{e.off("selectionUpdate",t),e.off("transaction",t)}},[e,s,a]),o}function A({editor:e,icon:s,tooltip:o,tooltipOptions:a}){const t=N(e,m.name),n=c.useCallback(()=>{if(t){e.chain().focus().removeTableOfContents().run();return}e.chain().focus().setTableOfContents().run()},[e,t]);return l.jsx(b.ActionButton,{action:n,isActive:()=>t||!1,icon:s,tooltip:o,tooltipOptions:a})}function j(e){return e&&e.type.name==="title"}function E(e,s){const a=[e.getJSON()],t=[];for(;a.length>0;){const n=a.shift();n.type===s&&t.push(n),n.content&&n.content.length>0&&a.push(...n.content)}return t}const m=h.Node.create({name:"tableOfContents",group:"block",atom:!0,addOptions(){var e;return{...(e=this.parent)==null?void 0:e.call(this),onHasOneBeforeInsert:()=>{},resizable:!0,lastColumnResizable:!0,allowTableNodeSelection:!1,button:({editor:s,t:o})=>({component:A,componentProps:{disabled:!1,icon:"BookMarked",tooltip:o("editor.table_of_content"),editor:s}})}},parseHTML(){return[{tag:"toc"}]},renderHTML({HTMLAttributes:e}){return["toc",h.mergeAttributes(e)]},addNodeView(){return p.ReactNodeViewRenderer(y)},addCommands(){return{setTableOfContents:()=>({commands:e,editor:s,view:o})=>{if(E(s,this.name).length>0){this.options.onHasOneBeforeInsert();return}const t=o.props.state.doc.content.firstChild;if(j(t)){const n=(t.firstChild&&t.firstChild.nodeSize||0)+1;return e.insertContentAt(n,{type:this.name})}return e.insertContent({type:this.name})},removeTableOfContents:()=>({state:e,dispatch:s})=>{const{tr:o}=e,a=e.schema.nodes.tableOfContents;return e.doc.descendants((t,n)=>{if(t.type===a){const i=n,r=n+t.nodeSize;o.delete(i,r)}}),o.docChanged?(s(o),!0):!1}}},addGlobalAttributes(){return[{types:["heading"],attributes:{id:{default:null}}}]}});exports.TableOfContents=m;
