/*
 *             Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Command as _0x294589,Plugin as _0x5e671f}from'@ckeditor/ckeditor5-core/dist/index.js';import{ButtonView as _0x10319c,MenuBarMenuListItemButtonView as _0x375eea,SpinnerView as _0x38e863,Notification as _0x2135ca}from'@ckeditor/ckeditor5-ui/dist/index.js';import{logWarning as _0x40f748,collectStylesheets as _0x236cd4}from'@ckeditor/ckeditor5-utils/dist/index.js';import{IconExportWord as _0x44d399}from'@ckeditor/ckeditor5-icons/dist/index.js';function a(_0x15acfc,_0x57cda6={}){const _0x38be09=_0x15acfc['plugins']['has']('Users'),_0x2b22c6=_0x15acfc['plugins']['has']('CommentsRepository'),_0x2ddd6f=_0x15acfc['plugins']['has']('TrackChanges'),_0x4553d4=_0x57cda6;if(_0x38be09&&_0x2b22c6){const _0x9524c0=function(_0x3d2552){const _0x51e81e={};if(!_0x3d2552['length'])return _0x51e81e;for(const _0xeda888 of _0x3d2552)_0xeda888['comments']['map'](_0x51f576=>{void 0x0===_0x51e81e[_0xeda888['id']]&&(_0x51e81e[_0xeda888['id']]=[]),_0x51e81e[_0xeda888['id']]['push']({'author':_0x51f576['author']['name'],'content':_0x51f576['content'],'created':_0x51f576['createdAt'],'is_resolved':_0xeda888['isResolved']});});return _0x51e81e;}(_0x15acfc['plugins']['get']('CommentsRepository')['getCommentThreads']({'skipNotAttached':!0x0,'skipEmpty':!0x0}));Object['keys'](_0x9524c0)['length']&&(_0x4553d4['comments']=_0x9524c0);}if(_0x38be09&&_0x2ddd6f){const _0x27f951=_0x15acfc['plugins']['get']('TrackChanges'),_0x8eb894=_0x15acfc['plugins']['get']('Users'),_0x379bdb=function(_0x24c293,_0x56d095){const _0x1c4c79={};if(!_0x24c293['length']||!_0x56d095['length'])return _0x1c4c79;for(const {id:_0x3b114f,createdAt:_0x112a1c,authorId:_0x53d829,attributes:_0x5d6847}of _0x24c293){const _0x49d7e8=_0x5d6847&&_0x5d6847['@external'],_0x560894=_0x49d7e8?_0x49d7e8['authorName']:_0x56d095['get'](_0x53d829)['name'];_0x1c4c79[_0x3b114f]={'author':_0x560894,'created':_0x112a1c};}return _0x1c4c79;}(_0x27f951['getSuggestions']({'toJSON':!0x0}),_0x8eb894['users']);Object['keys'](_0x379bdb)['length']&&(_0x4553d4['suggestions']=_0x379bdb);}return(_0x4553d4['suggestions']||_0x4553d4['comments'])&&(_0x4553d4['timezone']=new Intl['DateTimeFormat']()['resolvedOptions']()['timeZone']),_0x4553d4;}function m(_0x32f972,_0x2b0d24={}){const _0x573c5b=_0x32f972['plugins']['has']('Users'),_0x1f700b=_0x32f972['plugins']['has']('CommentsRepository'),_0x4101d6=_0x32f972['plugins']['has']('TrackChanges'),_0x4c431d=_0x32f972['plugins']['has']('MergeFields'),_0x13884c=_0x32f972['locale']['contentLanguage'],_0xbd4724=_0x2b0d24,_0x5432e9={};if(_0xbd4724['document']=_0xbd4724['document']||{},_0xbd4724['document']['language']=_0xbd4724['document']['language']||_0x13884c,_0x573c5b&&_0x1f700b){const _0xce72e7=function(_0x2ed5df){const _0xebad02=[];if(!_0x2ed5df['length'])return _0xebad02;for(const _0xffc00c of _0x2ed5df){const _0x4d0675=_0xffc00c['comments']['map'](_0xabb40b=>({'author':_0xabb40b['author']['name'],'content':_0xabb40b['content'],'created_at':_0xabb40b['createdAt']}));_0xebad02['push']({'thread_id':_0xffc00c['id'],'is_resolved':_0xffc00c['isResolved'],'comments':_0x4d0675});}return _0xebad02;}(_0x32f972['plugins']['get']('CommentsRepository')['getCommentThreads']({'skipNotAttached':!0x0,'skipEmpty':!0x0}));_0xce72e7['length']&&(_0x5432e9['comment_threads']=_0xce72e7);}if(_0x573c5b&&_0x4101d6){const _0x1c9c82=_0x32f972['plugins']['get']('TrackChanges'),_0x5f123d=_0x32f972['plugins']['get']('Users'),_0x87d5b=function(_0xb28d65,_0x1f1de5){if(!_0xb28d65['length']||!_0x1f1de5['length'])return[];return _0xb28d65['map'](({id:_0x3ebced,createdAt:_0x385e1a,authorId:_0x2d6e21,attributes:_0x5accf4})=>{const _0x364d62=_0x5accf4&&_0x5accf4['@external'];return{'id':_0x3ebced,'author':_0x364d62?_0x364d62['authorName']:_0x1f1de5['get'](_0x2d6e21)['name'],'created_at':_0x385e1a};});}(_0x1c9c82['getSuggestions']({'toJSON':!0x0}),_0x5f123d['users']);_0x87d5b['length']&&(_0x5432e9['suggestions']=_0x87d5b);}if(_0x4c431d){const _0x1eb289=_0x32f972['plugins']['get']('MergeFieldsEditing'),_0x4f0d21=_0x1eb289['previewMode'],{prefix:_0x1e9d48,suffix:_0x3c8ffb}=_0x32f972['config']['get']('mergeFields');if(_0xbd4724['merge_fields']={'prefix':_0x1e9d48,'suffix':_0x3c8ffb},'$labels'!==_0x4f0d21){_0xbd4724['merge_fields']['data']={};const _0x31eee6='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP88B8AAuUB8e2ujYwAAAAASUVORK5CYII=',_0x25545b='$defaultValues'===_0x4f0d21?_0x1eb289['getDefaultValues']():_0x1eb289['getDataSetValues'](_0x4f0d21,!0x0);for(const _0x4b6603 of Object['entries'](_0x25545b)){const [_0x3103b4,_0x24536f]=_0x4b6603;'image'===_0x1eb289['getMergeFieldType'](_0x3103b4)?_0xbd4724['merge_fields']['data'][_0x3103b4]=null!==_0x24536f?_0x24536f:_0x31eee6:_0xbd4724['merge_fields']['data'][_0x3103b4]=null!==_0x24536f?_0x24536f:_0x1eb289['getLabel'](_0x3103b4)||_0x3103b4;}}}return(_0x5432e9['comment_threads']||_0x5432e9['suggestions'])&&(_0xbd4724['timezone']=new Intl['DateTimeFormat']()['resolvedOptions']()['timeZone'],_0xbd4724['collaboration_features']=_0x5432e9),_0xbd4724;}function p(_0x3e9adf,_0x173f32){const t=_0x3e9adf['t'];switch(_0x173f32){case'Export\x20to\x20Word':return t('Export\x20to\x20Word');case'An\x20error\x20occurred\x20while\x20generating\x20the\x20Word\x20file.':return t('An\x20error\x20occurred\x20while\x20generating\x20the\x20Word\x20file.');case'Word\x20document\x20export\x20started':return t('Word\x20document\x20export\x20started');case'Word\x20document\x20export\x20failed':return t('Word\x20document\x20export\x20failed');case'Word\x20document\x20export\x20successful':return t('Word\x20document\x20export\x20successful');case'Exporting\x20Word\x20document':return t('Exporting\x20Word\x20document');default:return _0x173f32;}}const h=['orientation','margin_top','margin_right','margin_bottom','margin_left','format','header','footer','comments','suggestions'];class i extends _0x294589{constructor(_0x194bc9){super(_0x194bc9),this['set']('isBusy',!0x1),this['affectsData']=!0x1;}['refresh'](){this['isEnabled']=!this['isBusy'],this['value']=this['isBusy']?'pending':void 0x0;}['execute'](_0x361973={}){const _0x16fa0f=this['editor'],_0x32485d=_0x361973['version']||0x2,_0x37b323=0x1===_0x32485d,_0x3c0dbd=_0x361973['converterUrl']||(_0x37b323?'https://docx-converter.cke-cs.com/v1/convert':'https://docx-converter.cke-cs.com/v2/convert/html-docx'),_0xc2c49b=_0x361973['converterOptions']||{},_0x2163df=_0x16fa0f['plugins']['get']('ExportWord'),_0x2215fa=_0x361973['token']||_0x2163df['_token'],_0x4bed3e=!0x0===_0xc2c49b['auto_pagination'],_0x14b8e0=_0x361973['dataCallback']||(_0x354411=>_0x354411['data']['get']({'pagination':_0x4bed3e}));return 0x2===_0x32485d&&function(_0x46048a){for(const _0x2c918c of h)if(void 0x0!==_0x46048a[_0x2c918c])return!0x0;return!0x1;}(_0xc2c49b)&&_0x40f748('export-word-v1-api-is-deprecated'),this['isBusy']=!0x0,this['refresh'](),_0x236cd4(_0x361973['stylesheets']||['EDITOR_STYLES'])['then'](async _0x6750b9=>{_0x16fa0f['ui']['ariaLiveAnnouncer']['announce'](p(_0x16fa0f['locale'],'Word\x20document\x20export\x20started'));const _0xf2bcff=await _0x14b8e0(_0x16fa0f),_0x2e73c1={'html':'<div\x20class=\x22ck-content\x22\x20dir=\x22'+_0x16fa0f['locale']['contentLanguageDirection']+'\x22>'+_0xf2bcff+'</div>','css':_0x6750b9,[_0x37b323?'options':'config']:{..._0xc2c49b,..._0x37b323?a(_0x16fa0f,_0xc2c49b):m(_0x16fa0f,_0xc2c49b)}},_0x1db312={'method':'POST','headers':{'Content-Type':'application/json','Accept':'application/docx',..._0x2215fa?{'Authorization':_0x2215fa['value']}:null},'body':JSON['stringify'](_0x2e73c1)};return window['fetch'](_0x3c0dbd,_0x1db312)['then'](_0x9ffcfd=>{if(0xc8!==_0x9ffcfd['status'])throw _0x9ffcfd;return _0x9ffcfd['blob']();})['then'](_0x2aec52=>{_0x16fa0f['ui']['ariaLiveAnnouncer']['announce'](p(_0x16fa0f['locale'],'Word\x20document\x20export\x20successful'));const _0x285625='function'==typeof _0x361973['fileName']?_0x361973['fileName']():_0x361973['fileName'];this['_downloadFile'](_0x2aec52,_0x285625||'document.docx');});})['catch'](_0x2ec0ba=>{const _0x5c5028=_0x16fa0f['plugins']['get']('Notification');throw _0x16fa0f['ui']['ariaLiveAnnouncer']['announce'](p(_0x16fa0f['locale'],'Word\x20document\x20export\x20failed'),{'politeness':'assertive'}),_0x5c5028['showWarning'](p(_0x16fa0f['locale'],'An\x20error\x20occurred\x20while\x20generating\x20the\x20Word\x20file.')),_0x2ec0ba;})['finally'](()=>{this['isBusy']=!0x1,this['refresh']();});}['_downloadFile'](_0x54ff75,_0x5e38f8){const _0x4eb4cb=document['createElement']('a');_0x4eb4cb['href']=window['URL']['createObjectURL'](_0x54ff75),_0x4eb4cb['download']=_0x5e38f8,_0x4eb4cb['click'](),_0x4eb4cb['remove']();}}class o extends _0x5e671f{static get['pluginName'](){return'ExportWordUI';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}['init'](){const _0x2c9e79=this['editor'];_0x2c9e79['ui']['componentFactory']['add']('exportWord',()=>{const _0x2662a4=_0x2c9e79['commands']['get']('exportWord'),_0x25c7d9=this['_createButton'](_0x10319c);return _0x25c7d9['set']({'tooltip':!0x0}),_0x25c7d9['bind']('isOn')['to'](_0x2662a4,'isBusy'),_0x25c7d9;}),_0x2c9e79['ui']['componentFactory']['add']('menuBar:exportWord',()=>this['_createButton'](_0x375eea));}['_createButton'](_0x362a4d){const _0x2edc2a=this['editor'],_0x47c50f=_0x2edc2a['config']['get']('exportWord')||{},_0x3e319d=_0x2edc2a['commands']['get']('exportWord'),_0x311ff6=new _0x362a4d(_0x2edc2a['locale']),_0x7b7fd7=new _0x38e863();return _0x311ff6['children']['add'](_0x7b7fd7),_0x7b7fd7['bind']('isVisible')['to'](_0x3e319d,'isBusy'),_0x311ff6['iconView']['bind']('isVisible')['to'](_0x3e319d,'isBusy',_0x2f012c=>!_0x2f012c),_0x311ff6['set']({'icon':_0x44d399}),_0x311ff6['bind']('isEnabled')['to'](_0x3e319d,'isEnabled'),_0x311ff6['bind']('label')['to'](_0x3e319d,'isBusy',_0x34b101=>p(_0x2edc2a['locale'],_0x34b101?'Exporting\x20Word\x20document':'Export\x20to\x20Word')),this['listenTo'](_0x311ff6,'execute',()=>{_0x2edc2a['execute']('exportWord',_0x47c50f),_0x2edc2a['editing']['view']['focus']();}),_0x311ff6;}}class s extends _0x5e671f{['_token'];static get['pluginName'](){return'ExportWord';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}static get['requires'](){return['CloudServices',_0x2135ca,o];}['init'](){const _0x47c568=this['editor'],_0x49b1b6=_0x47c568['config']['get']('exportWord')||{};_0x47c568['commands']['add']('exportWord',new i(_0x47c568));const _0x5d4f9e=_0x47c568['plugins']['get']('CloudServices');!0x1===_0x49b1b6['tokenUrl']?this['_token']=null:_0x49b1b6['tokenUrl']?_0x5d4f9e['registerTokenUrl'](_0x49b1b6['tokenUrl'])['then'](_0x29dd1a=>{this['_token']=_0x29dd1a;}):this['_token']=_0x5d4f9e['token'];}}export{s as ExportWord};