/*
 *             Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x151e3d,Command as _0x15d4a7}from'@ckeditor/ckeditor5-core/dist/index.js';import{IconImportWord as _0x28dde4}from'@ckeditor/ckeditor5-icons/dist/index.js';import{FileDialogButtonView as _0x4fbd4d,MenuBarMenuListItemFileDialogButtonView as _0x4af913,SpinnerView as _0x98646d,Notification as _0xee15e5}from'@ckeditor/ckeditor5-ui/dist/index.js';import{ClipboardPipeline as _0x285551}from'@ckeditor/ckeditor5-clipboard/dist/index.js';import{Range as _0x4a734b}from'@ckeditor/ckeditor5-engine/dist/index.js';import{first as _0x31a809,uid as _0x5d202c,logWarning as _0x141919,logError as _0x189e65}from'@ckeditor/ckeditor5-utils/dist/index.js';function p(_0x619c3c,_0x19a7ff){const t=_0x619c3c['t'];switch(_0x19a7ff){case'Import\x20from\x20Word':return t('Import\x20from\x20Word');case'An\x20error\x20occurred\x20while\x20importing\x20the\x20Word\x20file.':return t('An\x20error\x20occurred\x20while\x20importing\x20the\x20Word\x20file.');case'Importing\x20Word\x20document':return t('Importing\x20Word\x20document');default:return _0x19a7ff;}}class i extends _0x151e3d{static get['pluginName'](){return'ImportWordUI';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}['init'](){const _0x5dd927=this['editor'];_0x5dd927['ui']['componentFactory']['add']('importWord',()=>{const _0x3da24e=this['_createButton'](_0x4fbd4d),_0x2c5f1b=_0x5dd927['commands']['get']('importWord');return _0x3da24e['bind']('isOn')['to'](_0x2c5f1b,'isBusy'),_0x3da24e['tooltip']=!0x0,_0x3da24e;}),_0x5dd927['ui']['componentFactory']['add']('menuBar:importWord',()=>this['_createButton'](_0x4af913));}['_createButton'](_0x4d7c8d){const _0x1d041e=this['editor'],_0x529865=_0x1d041e['commands']['get']('importWord'),_0x5e219b=new _0x4d7c8d(_0x1d041e['locale']),_0x2da534=new _0x98646d();return _0x5e219b['set']({'acceptedType':'application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.wordprocessingml.template'}),_0x5e219b['set']({'icon':_0x28dde4}),_0x5e219b['bind']('isEnabled')['to'](_0x529865),_0x5e219b['bind']('label')['to'](_0x529865,'isBusy',_0x336847=>p(_0x1d041e['locale'],_0x336847?'Importing\x20Word\x20document':'Import\x20from\x20Word')),_0x2da534['bind']('isVisible')['to'](_0x529865,'isBusy'),_0x5e219b['iconView']['bind']('isVisible')['to'](_0x529865,'isBusy',_0x4310e6=>!_0x4310e6),_0x5e219b['children']['add'](_0x2da534),_0x5e219b['on']('done',(_0x27f43e,_0x58a793)=>{_0x1d041e['execute']('importWord',_0x58a793[0x0],{}),_0x1d041e['editing']['view']['focus']();}),_0x5e219b;}}class d extends _0x15d4a7{['_importMarker'];['_undoStepBatch'];['_abortController'];constructor(_0x42df04){super(_0x42df04),this['set']('isBusy',!0x1),this['_importMarker']=null,this['_undoStepBatch']=null,this['_abortController']=null,this['on']('dataInsert',(_0x3013f5,_0x584328)=>{const _0x5ca03f=new DataTransfer();_0x5ca03f['setData']('text/html',_0x584328['html']);const _0x308bc6=this['_importMarker']['getRange']();this['editor']['model']['enqueueChange'](this['_undoStepBatch'],_0x2ed85d=>{this['_importMarker']['stopListening'](),_0x2ed85d['setSelection'](_0x308bc6),_0x42df04['editing']['view']['document']['fire']('clipboardInput',{'dataTransfer':_0x5ca03f});});},{'priority':'low'});}['refresh'](){this['isEnabled']=this['_checkEnabled']();}['execute'](_0x196106,_0x2272f3={}){if(this['isBusy'])return Promise['resolve']();const _0xbd61ea=this['editor']['config']['get']('importWord');if(this['editor']['plugins']['has']('MergeFields')){const {prefix:_0x11a3c7,suffix:_0x264d6a}=this['editor']['config']['get']('mergeFields');_0x2272f3['merge_fields']={'prefix':_0x11a3c7,'suffix':_0x264d6a};}const _0x1e52a9={'url':_0xbd61ea['converterUrl'],'file':_0x196106,'serviceConfig':{..._0x2272f3,'formatting':_0xbd61ea['formatting'],'timezone':new Intl['DateTimeFormat']()['resolvedOptions']()['timeZone']}};return this['_prepareForImport'](),this['_sendImportRequest'](_0x1e52a9)['then'](this['_handleImportResponse']['bind'](this))['catch'](this['_handleImportFailure']['bind'](this))['finally'](this['_cleanUpAfterImport']['bind'](this));}['_checkEnabled'](){if(this['isBusy'])return!0x1;const _0xefb4c2=this['editor']['model'],_0x57bf3d=_0xefb4c2['schema'],_0x4ac98d=_0xefb4c2['document']['selection'],_0x4533e1=_0x31a809(_0x4ac98d['getSelectedBlocks']());return!!_0x4533e1&&_0x57bf3d['checkChild'](_0x4533e1['parent'],'paragraph');}['_prepareForImport'](){const _0x1228f9=this['editor'],_0x52590a=_0x1228f9['model'],_0x5f1f21=_0x52590a['document']['selection'];this['_abortController']=new AbortController(),this['_undoStepBatch']=_0x1228f9['model']['createBatch']({'isUndoable':!0x0}),_0x52590a['enqueueChange'](this['_undoStepBatch'],_0x2bec13=>{_0x5f1f21['isCollapsed']||_0x52590a['deleteContent'](_0x5f1f21,{'leaveUnmerged':!0x0});const _0xc671b5=_0x5f1f21['getFirstPosition'](),_0x245216=_0x31a809(_0x5f1f21['getSelectedBlocks']());let _0x3e1fb6;_0x3e1fb6=_0x245216['is']('element','paragraph')&&_0x245216['isEmpty']?_0xc671b5:_0xc671b5['isAtStart']?_0x52590a['createPositionBefore'](_0x245216):_0xc671b5['isAtEnd']?_0x52590a['createPositionAfter'](_0x245216):_0x2bec13['split'](_0xc671b5)['position'],this['_importMarker']=_0x2bec13['addMarker']('importWord:'+_0x5d202c(),{'usingOperation':!0x1,'affectsData':!0x1,'range':new _0x4a734b(_0x3e1fb6)}),this['_importMarker']['on']('change:range',()=>{'$graveyard'===this['_importMarker']['getRange']()['root']['rootName']&&this['_abortController']['abort']();});}),this['isBusy']=!0x0,this['refresh']();}['_cleanUpAfterImport'](){const _0x3404a6=this['editor']['model'];_0x3404a6['markers']['has'](this['_importMarker'])&&_0x3404a6['enqueueChange'](this['_undoStepBatch'],_0x236ca1=>{_0x236ca1['removeMarker'](this['_importMarker']);}),this['_importMarker']=null,this['_undoStepBatch']=null,this['_abortController']=null,this['isBusy']=!0x1,this['refresh']();}['_sendImportRequest']({url:_0x122453,file:_0x57d9f0,serviceConfig:_0x4d6f54}){const _0x44fffe=this['editor']['plugins']['get']('ImportWordEditing')['getToken'](),_0x1ebb37=new FormData();_0x1ebb37['set']('config',JSON['stringify'](_0x4d6f54)),_0x1ebb37['set']('file',_0x57d9f0);const _0x1b0104={'method':'POST','headers':{},'body':_0x1ebb37,'signal':this['_abortController']['signal']};return _0x44fffe&&(_0x1b0104['headers']['Authorization']=_0x44fffe['value']),fetch(_0x122453,_0x1b0104);}['_handleImportResponse'](_0x466f0b){return _0x466f0b['ok']?_0x466f0b['json']()['then'](_0x550ec8=>{if(!this['editor']['model']['markers']['has'](this['_importMarker']))return;'$graveyard'!==this['_importMarker']['getRange']()['root']['rootName']&&this['fire']('dataInsert',_0x550ec8);}):Promise['reject']();}['_handleImportFailure'](){if(this['_abortController']['signal']['aborted'])return void _0x141919('import-word-plugin-import-cancelled');const _0xda2a3f=this['editor'],_0xb304a1=p(_0xda2a3f['locale'],'An\x20error\x20occurred\x20while\x20importing\x20the\x20Word\x20file.');_0xda2a3f['plugins']['get']('Notification')['showWarning'](_0xb304a1),_0x189e65('import-word-plugin-conversion-failed');}}class e extends _0x151e3d{['_token'];static get['pluginName'](){return'ImportWordEditing';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}static get['requires'](){return[_0xee15e5,_0x285551,'CloudServices'];}constructor(_0x44a772){super(_0x44a772),this['_token']=null;}async['init'](){const _0x5c4495=this['editor'];_0x5c4495['config']['define']('importWord',{'converterUrl':'https://docx-converter.cke-cs.com/v2/convert/docx-html','tokenUrl':(_0x5c4495['config']['get']('cloudServices')||{})['tokenUrl'],'formatting':{'resets':'none','defaults':'none','styles':'inline'}}),_0x5c4495['commands']['add']('importWord',new d(_0x5c4495));const {tokenUrl:_0x25362f}=_0x5c4495['config']['get']('importWord');if(_0x25362f){const {tokenUrl:_0x4bae59}=_0x5c4495['config']['get']('cloudServices')||{};this['_token']=_0x25362f===_0x4bae59?_0x5c4495['plugins']['get']('CloudServices')['token']:await _0x5c4495['plugins']['get']('CloudServices')['registerTokenUrl'](_0x25362f);}}['getToken'](){return this['_token'];}}class o extends _0x151e3d{static get['pluginName'](){return'ImportWord';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}static get['requires'](){return[e,i];}}export{o as ImportWord,e as ImportWordEditing,i as ImportWordUI};