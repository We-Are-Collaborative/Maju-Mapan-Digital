/*
 *             Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x3f2adc}from'ckeditor5/src/core.js';import{FileRepository as _0x1709b1}from'ckeditor5/src/upload.js';import _0x305618 from'./uploadcareediting.js';import _0x2b6f8e from'./utils/uploadutils.js';import{getImageUrls as _0x3a37de}from'./utils/editingutils.js';export default class p extends _0x3f2adc{static get['requires'](){return['ImageUploadEditing','ImageUploadProgress',_0x1709b1,_0x305618];}static get['pluginName'](){return'UploadcareUploadAdapter';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}async['afterInit'](){const _0x9ac2cc=this['editor'];if(!!!_0x9ac2cc['config']['get']('uploadcare'))return;_0x9ac2cc['plugins']['get'](_0x1709b1)['createUploadAdapter']=_0x2c984b=>new x(_0x2c984b,_0x9ac2cc),_0x9ac2cc['plugins']['get']('ImageUploadEditing')['on']('uploadComplete',(_0xf91b99,{imageElement:_0x4caeb3,data:_0x7f9bc0})=>{_0x9ac2cc['model']['change'](_0x10f9eb=>{_0x10f9eb['setAttribute']('uploadcareImageId',_0x7f9bc0['uploadcareImageId'],_0x4caeb3);});});}}class x{['loader'];['editor'];['controller'];constructor(_0xb0cab5,_0x296737){this['loader']=_0xb0cab5,this['editor']=_0x296737,this['controller']=new AbortController();}async['upload'](){const t=this['editor']['t'],_0x1b5fc5=this['editor']['config']['get']('uploadcare.pubkey'),_0x4a344e=await this['loader']['file'];return _0x2b6f8e['upload']({'file':_0x4a344e,'publicKey':_0x1b5fc5,'signal':this['controller']['signal'],'onProgress':_0x352ebf=>{_0x352ebf&&_0x352ebf['isComputable']&&(this['loader']['uploadTotal']=0x1,this['loader']['uploaded']=_0x352ebf['value']);}})['then'](async _0x47a637=>{const {imageFallbackUrl:_0x5919ce,imageSources:_0x1b13cc}=_0x3a37de(_0x47a637['cdnUrl'],_0x47a637['imageInfo']['width']);return{'uploadcareImageId':_0x47a637['uuid'],'default':_0x5919ce,'sources':_0x1b13cc};})['catch'](()=>{const _0xbf179e=t('Cannot\x20upload\x20file:')+('\x20'+_0x4a344e['name']+'.');return Promise['reject'](_0xbf179e);});}['abort'](){this['controller']['abort']();}}