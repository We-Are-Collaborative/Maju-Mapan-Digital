/*
 *             Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{EmitterMixin}from'ckeditor5/src/utils.js';import _0x5826ff from'./../messagescompressor.js';import _0x4dcb12 from'./messages/addsuggestionmessage.js';import _0x38baab from'./responses/addsuggestionresponse.js';import _0x149028 from'./messages/getsuggestionmessage.js';import _0x53d9ae from'./responses/getsuggestionresponse.js';import _0x594d0c from'./messages/getallsuggestionsmessage.js';import _0x4b509c from'./responses/getallsuggestionsresponse.js';import _0x3e7354 from'./messages/updatesuggestionmessage.js';import _0x1cd624 from'./messages/connectmessage.js';import _0x310b5d from'./responses/connectresponse.js';import _0x7b725a from'../ckeditorcloudserviceserror.js';import _0x226f53,{WEB_SOCKET_GATEWAY_STATES}from'../websocketgateway/websocketgateway.js';import _0x4ecf68 from'../errors/ServiceNotConnectedError.js';import _0x27b971 from'../ckeditorcloudservicesservererror.js';import _0x24b3c6 from'./messages/batchUpdateSuggestionsStateMessage.js';export const _SERVICE=0xa;class TrackChangesService extends/* #__PURE__ -- @preserve */
EmitterMixin(){['_documentId'];['_isConnected']=!0x1;['_wsGateway'];['_channel'];static ['_SERVICE']=0xa;constructor(_0x547c51){super(),this['_documentId']=_0x547c51;}get['isConnected'](){return this['_isConnected'];}async['connect'](_0x42d08c){if(this['_isConnected'])return;if(_0x42d08c['state']!==WEB_SOCKET_GATEWAY_STATES['CONNECTED'])throw new _0x7b725a('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x42d08c);const _0x4ce5f4=new _0x1cd624(this['_documentId']);this['_wsGateway']=_0x42d08c,this['stopListening'](_0x42d08c,'change:state');const _0x7ccb6d=await _0x42d08c['_sendRequest'](0xa,_0x1cd624['TYPE'],_0x5826ff['encode'](_0x4ce5f4)),_0x380008=_0x5826ff['decode'](_0x7ccb6d,_0x310b5d);return this['listenTo'](_0x42d08c,'change:state',(_0x48e7a,_0x2332ab,_0x24ba43)=>this['_onWsGatewayStateChange'](_0x24ba43),{'priority':_0x226f53['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x42d08c,_0x380008['channel']),this['_isConnected']=!0x0,this['fire']('connected'),_0x380008['suggestions'];}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['add'](_0x23cbf8,_0x290c03,_0x196eb8,_0x207b7f=null,_0x29350b){const _0x1118c0=new _0x4dcb12(_0x23cbf8,this['_documentId'],_0x290c03,_0x196eb8,_0x207b7f,_0x29350b),_0x4d64d1=await this['_sendRequest'](_0x4dcb12['TYPE'],_0x1118c0);return _0x5826ff['decode'](_0x4d64d1,_0x38baab);}async['get'](_0x52ac75,_0x153f44=0x1){const _0x52d4e0=new _0x149028(_0x52ac75,this['_documentId']);try{const _0x24c832=await this['_sendRequest'](_0x149028['TYPE'],_0x52d4e0);return _0x5826ff['decode'](_0x24c832,_0x53d9ae);}catch(_0x343b4a){if('CKEditorCloudServicesServerError'===_0x343b4a['name']&&'404'===_0x343b4a['code']&&_0x153f44<0x5)return await(_0x2f6047=0x64*_0x153f44,new Promise(_0x26ee6c=>{setTimeout(_0x26ee6c,_0x2f6047);})),this['get'](_0x52ac75,_0x153f44+0x1);if('CKEditorCloudServicesServerError'===_0x343b4a['name'])throw _0x343b4a;throw _0x27b971['fromPublicError'](_0x343b4a);}var _0x2f6047;}async['getAll'](){const _0x505741=new _0x594d0c(this['_documentId']),_0xd4cc42=await this['_sendRequest'](_0x594d0c['TYPE'],_0x505741),{suggestions:_0x325e44}=_0x5826ff['decode'](_0xd4cc42,_0x4b509c);return _0x325e44;}async['update'](_0x3090b5,_0x49f9aa={}){const {hasComments:_0x3855a3,state:_0x29631d,attributes:_0x44bf9f}=_0x49f9aa,_0x5c2600=void 0x0!==_0x3855a3,_0x3b2f1f=new _0x3e7354(_0x3090b5,this['_documentId'],_0x3855a3,_0x5c2600,_0x29631d,_0x44bf9f);await this['_sendRequest'](_0x3e7354['TYPE'],_0x3b2f1f);}async['batchUpdateState'](_0x14275f){const _0x35fa24=new _0x24b3c6(_0x14275f['ids'],this['_documentId'],_0x14275f['state']);await this['_sendRequest'](_0x24b3c6['TYPE'],_0x35fa24);}['_connectToChannel'](_0x70b69e,_0x918197){this['_channel']=_0x70b69e['_getChannel'](TrackChangesService['_SERVICE'],_0x918197),this['_channel']&&this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x3e7354['TYPE']),(_0x519ff3,_0x52c49f)=>{const _0x2be036=_0x5826ff['decode'](_0x52c49f,_0x3e7354);this['fire']('suggestionUpdated',_0x2be036);});}['_onWsGatewayStateChange'](_0x32a827){_0x32a827===WEB_SOCKET_GATEWAY_STATES['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x543974,_0x2feff6){if(!this['_wsGateway']||!this['_isConnected'])throw new _0x4ecf68('Track\x20Changes',this);return this['_wsGateway']['_sendRequest'](0xa,_0x543974,_0x5826ff['encode'](_0x2feff6));}}export default TrackChangesService;