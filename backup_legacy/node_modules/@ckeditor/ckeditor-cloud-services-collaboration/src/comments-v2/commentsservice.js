/*
 *             Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{EmitterMixin}from'ckeditor5/src/utils.js';import _0x6941ac from'./../messagescompressor.js';import _0x1a046e from'./messages/addcommentmessage.js';import _0x5c2329 from'./responses/addcommentresponse.js';import _0x53e04d from'./messages/connectmessage.js';import _0x35dafe from'./responses/connectresponse.js';import _0x4a88e4 from'./messages/removecommentmessage.js';import _0x5c38b7 from'./messages/removecommentthreadmessage.js';import _0x507442 from'./messages/updatecommentmessage.js';import _0xe5394e from'./messages/getcommentthreadmessage.js';import _0x2ad195 from'./responses/getcommentthreadresponse.js';import _0x34ea44 from'./messages/getdocumentthreadsmessage.js';import _0x14c2a4 from'./responses/getdocumentthreadsresponse.js';import _0x2a21bf,{WEB_SOCKET_GATEWAY_STATES}from'./../websocketgateway/websocketgateway.js';import _0x526164 from'./../ckeditorcloudserviceserror.js';import _0x5c24f2 from'../sessions/sessions.js';import _0x4656cd from'../errors/ServiceNotConnectedError.js';import _0x4c0398 from'../ckeditorcloudservicesservererror.js';import _0x3f5a6d from'./responses/comment-threads/addcommentthreadresponse.js';import _0x104d72 from'./messages/comment-threads/addcommentthreadmessage.js';import _0x500e6c from'./messages/comment-threads/resolvecommentthreadmessage.js';import _0x362b95 from'./messages/comment-threads/reopencommentthreadmessage.js';import _0x12f964 from'./messages/comment-threads/updatecommentthreadmessage.js';import _0x23c1eb from'./responses/comment-threads/resolvecommentthreadresponse.js';export const _SERVICE=0x9;class CommentsService extends/* #__PURE__ -- @preserve */
EmitterMixin(){['_documentId'];['_isConnected']=!0x1;['_wsGateway'];['_channel'];['_connectedSessions'];static ['_SERVICE']=0x9;constructor(_0x202f2e){super(),this['_documentId']=_0x202f2e;}get['isConnected'](){return this['_isConnected'];}async['connect'](_0x4f18b1){if(this['_isConnected'])return;if(_0x4f18b1['state']!==WEB_SOCKET_GATEWAY_STATES['CONNECTED'])throw new _0x526164('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x4f18b1);const _0x49410d=new _0x53e04d(this['_documentId']);this['_wsGateway']=_0x4f18b1,this['stopListening'](_0x4f18b1,'change:state');const _0x43152f=await _0x4f18b1['_sendRequest'](0x9,_0x53e04d['TYPE'],_0x6941ac['encode'](_0x49410d)),{channel:_0x2c81cf,threads:_0x4765b5}=_0x6941ac['decode'](_0x43152f,_0x35dafe);return this['listenTo'](_0x4f18b1,'change:state',(_0x2e9bdf,_0x3b0e08,_0x365047)=>this['_onWsGatewayStateChange'](_0x365047),{'priority':_0x2a21bf['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x4f18b1,_0x2c81cf),this['_isConnected']=!0x0,this['fire']('connected'),_0x4765b5;}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['_connectedSessions']&&(this['_connectedSessions']['disconnect'](),this['_connectedSessions']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['addComment'](_0x189bc5,_0x451cd6,_0x2d1017,_0x4fddca){const _0x42de31=new _0x1a046e(this['_documentId'],_0x189bc5,_0x2d1017,_0x451cd6,void 0x0,void 0x0,_0x4fddca),_0xba212f=await this['_sendRequest'](_0x1a046e['TYPE'],_0x42de31);return _0x6941ac['decode'](_0xba212f,_0x5c2329);}async['updateComment'](_0xbda724,_0xcce638,_0x497609,_0x249da0){const _0x22c3bc=void 0x0!==_0x249da0,_0x4da251=new _0x507442(this['_documentId'],_0xbda724,_0xcce638,_0x497609,_0x249da0,_0x22c3bc);await this['_sendRequest'](_0x507442['TYPE'],_0x4da251);}async['removeComment'](_0xf369df,_0x452b71){const _0x1327e4=new _0x4a88e4(this['_documentId'],_0xf369df,_0x452b71);await this['_sendRequest'](_0x4a88e4['TYPE'],_0x1327e4);}async['removeCommentThread'](_0x3baf91){const _0x53f7ac=new _0x5c38b7(this['_documentId'],_0x3baf91);await this['_sendRequest'](_0x5c38b7['TYPE'],_0x53f7ac);}async['addCommentThread'](_0x2c9b73){const _0x3bcd81=new _0x104d72(this['_documentId'],_0x2c9b73['commentThreadId'],_0x2c9b73['comments']?.['map'](_0x3da662=>({..._0x3da662,'documentId':this['_documentId'],'commentThreadId':_0x2c9b73['commentThreadId']})),_0x2c9b73['context'],_0x2c9b73['resolvedBy'],_0x2c9b73['createdAt'],_0x2c9b73['resolvedAt'],_0x2c9b73['deletedAt'],_0x2c9b73['attributes']),_0x205259=await this['_sendRequest'](_0x104d72['TYPE'],_0x3bcd81);return _0x6941ac['decode'](_0x205259,_0x3f5a6d);}async['resolveCommentThread'](_0x1195c6){const _0x1cb187=new _0x500e6c(_0x1195c6,this['_documentId']),_0x5dd8b1=await this['_sendRequest'](_0x500e6c['TYPE'],_0x1cb187);return _0x6941ac['decode'](_0x5dd8b1,_0x23c1eb);}async['reopenCommentThread'](_0x4820bf){const _0x3afd27=new _0x362b95(_0x4820bf,this['_documentId']);await this['_sendRequest'](_0x362b95['TYPE'],_0x3afd27);}async['updateCommentThread'](_0x172f05){const _0x5c39a5=new _0x12f964(_0x172f05['commentThreadId'],this['_documentId'],_0x172f05['context'],_0x172f05['attributes'],_0x172f05['unlinkedAt']);await this['_sendRequest'](_0x12f964['TYPE'],_0x5c39a5);}async['getCommentThread'](_0x5b4b6a,_0x2bcc5d=0x1){const _0x41dc0c=new _0xe5394e(_0x5b4b6a,this['_documentId']);try{const _0x2bb468=await this['_sendRequest'](_0xe5394e['TYPE'],_0x41dc0c),_0xc96684=_0x6941ac['decode'](_0x2bb468,_0x2ad195);return{'commentThreadId':_0xc96684['commentThreadId'],'comments':_0xc96684['comments'],'attributes':_0xc96684['attributes'],'context':_0xc96684['context'],'resolvedAt':_0xc96684['resolvedAt'],'resolvedBy':_0xc96684['resolvedBy'],'deletedAt':_0xc96684['deletedAt'],'unlinkedAt':_0xc96684['unlinkedAt']};}catch(_0x30297e){if('CKEditorCloudServicesServerError'===_0x30297e['name']&&'404'===_0x30297e['code']&&_0x2bcc5d<0x5)return await(_0x3df2fb=0x64*_0x2bcc5d,new Promise(_0x25ec94=>{setTimeout(_0x25ec94,_0x3df2fb);})),this['getCommentThread'](_0x5b4b6a,_0x2bcc5d+0x1);if('CKEditorCloudServicesServerError'===_0x30297e['name'])throw _0x30297e;throw _0x4c0398['fromPublicError'](_0x30297e);}var _0x3df2fb;}async['getDocumentThreads'](){const _0x140577=new _0x34ea44(this['_documentId']),_0x42dbcc=await this['_sendRequest'](_0x34ea44['TYPE'],_0x140577),{threads:_0x115e46}=_0x6941ac['decode'](_0x42dbcc,_0x14c2a4);return{'threads':_0x115e46};}async['getConnectedSessions'](){if(!this['_isConnected'])throw new _0x4656cd('Comments',this);return this['_connectedSessions']||(this['_connectedSessions']=await _0x5c24f2['getConnectedSessions'](this['_wsGateway'],this['_documentId'],0x9)),this['_connectedSessions'];}['_connectToChannel'](_0x5ae97f,_0x132b6d){this['_channel']=_0x5ae97f['_getChannel'](CommentsService['_SERVICE'],_0x132b6d),this['_channel']&&(this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x1a046e['TYPE']),(_0x4c95d9,_0x4bd345)=>{const _0x38667d=_0x6941ac['decode'](_0x4bd345,_0x1a046e);this['fire']('commentAdded',_0x38667d);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x4a88e4['TYPE']),(_0x20118b,_0x3943e8)=>{const _0x3d2665=_0x6941ac['decode'](_0x3943e8,_0x4a88e4);this['fire']('commentRemoved',_0x3d2665);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x507442['TYPE']),(_0x1b62bf,_0x2be4a8)=>{const _0x571c99=_0x6941ac['decode'](_0x2be4a8,_0x507442);this['fire']('commentUpdated',_0x571c99);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x5c38b7['TYPE']),(_0x3a8b9b,_0x458485)=>{const _0x1b7e8e=_0x6941ac['decode'](_0x458485,_0x5c38b7);this['fire']('commentThreadRemoved',_0x1b7e8e);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x104d72['TYPE']),(_0x1a59d9,_0x1c7e01)=>{const _0x4e4d31=_0x6941ac['decode'](_0x1c7e01,_0x104d72);this['fire']('commentThreadAdded',_0x4e4d31);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x12f964['TYPE']),(_0x66f9a7,_0x41c9ef)=>{const _0x5759f5=_0x6941ac['decode'](_0x41c9ef,_0x12f964);this['fire']('commentThreadUpdated',_0x5759f5);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x500e6c['TYPE']),(_0x34b125,_0x4f750d)=>{const _0x2ce773=_0x6941ac['decode'](_0x4f750d,_0x500e6c);this['fire']('commentThreadResolved',_0x2ce773);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x362b95['TYPE']),(_0x53b42b,_0x1f84fd)=>{const _0x15d5e8=_0x6941ac['decode'](_0x1f84fd,_0x362b95);this['fire']('commentThreadReopened',_0x15d5e8);}));}['_onWsGatewayStateChange'](_0x5611f9){_0x5611f9===WEB_SOCKET_GATEWAY_STATES['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x1be7ec,_0x55be5e){if(!this['_wsGateway']||!this['_isConnected'])throw new _0x4656cd('Comments',this);return this['_wsGateway']['_sendRequest'](0x9,_0x1be7ec,_0x6941ac['encode'](_0x55be5e));}}export default CommentsService;