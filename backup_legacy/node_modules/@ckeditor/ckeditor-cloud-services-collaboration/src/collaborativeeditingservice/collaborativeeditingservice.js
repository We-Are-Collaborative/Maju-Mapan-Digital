/*
 *             Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{v4 as _0x31becd}from'uuid';import{EmitterMixin}from'ckeditor5/src/utils.js';import _0x150a4a from'./../messagescompressor.js';import _0x47b296 from'./../sessions/sessions.js';import _0x4c60cd from'./messages/collaborativeeditingconnectmessage.js';import _0xf62b75 from'./messages/collaborativeeditingupdatemessage.js';import _0x4b40ea from'./messages/collaborativeeditingreconnectmessage.js';import _0x599836 from'./responses/collaborativeeditingresponse.js';import _0x1ba333 from'./responses/collaborativeeditingconnectresponse.js';import _0x1a0822 from'./../websocketgateway/websocketgateway.js';import _0x2f15e5 from'../ckeditorcloudserviceserror.js';import _0xda9c67 from'../errors/ServiceNotConnectedError.js';import _0x568761 from'./responses/getdocumentdetailsresponse.js';import _0x3d7df3 from'./messages/getdocumentdetailsmessage.js';export const _SERVICE=0x1;export default class extends/* #__PURE__ -- @preserve */
EmitterMixin(){static ['_SERVICE']=0x1;['_bundleVersion'];['_id'];['_isConnected'];['_wsGateway'];['_channel'];['_connectedSessions'];constructor(_0x2784e0,_0x564719){if(super(),!_0x2784e0)throw new TypeError('Param\x20\x22bundleVersion\x22\x20must\x20be\x20provided.');this['_id']=_0x564719??_0x31becd(),this['_isConnected']=!0x1,this['_bundleVersion']=_0x2784e0;}['getId'](){return this['_id'];}['isConnected'](){return this['_isConnected'];}['connect'](_0x17123b,_0x19ce9a={'buffers':[],'types':[]},_0x50fe79){const _0xed8e65=new _0x4c60cd(this['getId'](),_0x19ce9a['buffers'],_0x19ce9a['types'],this['_bundleVersion'],_0x50fe79);return this['_connect'](_0x17123b,_0xed8e65);}['reconnect'](_0x4093ab,_0xcec810){if(this['isConnected']())throw new _0x2f15e5('Cannot\x20reconnect\x20to\x20already\x20connected\x20service.',_0x4093ab);return this['_connect'](_0x4093ab,new _0x4b40ea(this['getId'](),_0xcec810,this['_bundleVersion']));}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['_connectedSessions']&&(this['_connectedSessions']['disconnect'](),this['_connectedSessions']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['getDocumentDetails'](){const _0x459ed9=new _0x3d7df3(this['getId']());if(!this['_wsGateway'])throw new _0xda9c67('Collaborative\x20Editing',this);const _0x1cb4ff=await this['_wsGateway']['_sendRequest'](0x1,_0x3d7df3['TYPE'],_0x150a4a['encode'](_0x459ed9));return _0x150a4a['decode'](_0x1cb4ff,_0x568761);}async['sendOperations'](_0x253c69,_0x20842,_0x567c6c){if(!_0x253c69?.['types']?.['length'])throw new _0x2f15e5('Cannot\x20send\x20empty\x20update.',this['_wsGateway']);const _0x1eecc8='number'==typeof _0x20842?_0x20842:parseInt(_0x20842);if(!Number['isInteger'](_0x1eecc8)||_0x1eecc8<0x0)throw new _0x2f15e5('Base\x20version\x20not\x20provided.',this['_wsGateway']);const _0x464980=new _0xf62b75(this['getId'](),_0x253c69['buffers'],_0x253c69['types'],_0x1eecc8,[],_0x567c6c);if(!this['_wsGateway']||!this['_isConnected'])throw new _0xda9c67('Collaborative\x20Editing',this);const _0x18c307=await this['_wsGateway']['_sendRequest'](0x1,_0xf62b75['TYPE'],_0x150a4a['encode'](_0x464980));return _0x150a4a['decode'](_0x18c307,_0x599836);}async['getConnectedSessions'](){if(!this['_isConnected'])throw new _0xda9c67('Collaborative\x20Editing',this);return this['_connectedSessions']||(this['_connectedSessions']=await _0x47b296['getConnectedSessions'](this['_wsGateway'],this['_id'],0x1)),this['_connectedSessions'];}static['getConnectedSessions'](_0x389f98,_0x51bf3e){return _0x47b296['getConnectedSessions'](_0x389f98,_0x51bf3e,0x1);}async['_connect'](_0x4efed6,_0x8224e){if(this['isConnected']())return;if(_0x4efed6['state']!==_0x1a0822['STATE_CONNECTED'])throw new _0x2f15e5('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x4efed6);this['_wsGateway']=_0x4efed6,this['stopListening'](_0x4efed6,'change:state');const _0x4ab81e=await _0x4efed6['_sendRequest'](0x1,_0x8224e['constructor']['TYPE'],_0x150a4a['encode'](_0x8224e)),_0x1d2fc3=_0x150a4a['decode'](_0x4ab81e,_0x1ba333);return this['listenTo'](_0x4efed6,'change:state',(_0x2a6c0a,_0x4e3a08,_0x1bfd60)=>this['_onWsGatewayStateChange'](_0x1bfd60),{'priority':_0x1a0822['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x4efed6,_0x1d2fc3['channel']),this['_isConnected']=!0x0,this['fire']('connected'),_0x1d2fc3;}['_connectToChannel'](_0x57e588,_0x57cebb){this['_channel']=_0x57e588['_getChannel'](0x1,_0x57cebb),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0xf62b75['TYPE']),(_0x27c1b5,_0xb73c66)=>{const _0x4b5100=_0x150a4a['decode'](_0xb73c66,_0xf62b75);this['fire']('operationsReceived',_0x4b5100['baseVersion'],_0x4b5100['data'],_0x4b5100['metadata']);});}['_onWsGatewayStateChange'](_0x1154a6){_0x1154a6===_0x1a0822['STATE_DISCONNECTED']&&this['disconnect']();}}