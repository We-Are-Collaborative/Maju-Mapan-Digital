/*
 *             Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{EmitterMixin}from'ckeditor5/src/utils.js';import _0x133f23 from'./../messagescompressor.js';import _0x4aa15e from'./messages/revisionhistorygetrevisionmessage.js';import _0x5ae8dc from'./responses/revisionhistorygetrevisionresponse.js';import _0x25720b from'./messages/revisionhistoryupdaterevisionsmessage.js';import _0x35f35c from'./responses/revisionhistoryupdaterevisionsresponse.js';import _0x5ceed8 from'./messages/revisionhistoryconnectmessage.js';import _0x2ebe56 from'./responses/revisionhistoryconnectresponse.js';import _0x48609f from'./messages/revisionhistoryreconnectmessage.js';import _0x1995d2 from'../ckeditorcloudserviceserror.js';import _0x59dfe3,{WEB_SOCKET_GATEWAY_STATES}from'../websocketgateway/websocketgateway.js';import _0x45f96a from'../errors/ServiceNotConnectedError.js';export const _SERVICE=0xc;class RevisionHistoryService extends/* #__PURE__ -- @preserve */
EmitterMixin(){['_documentId'];['_isConnected']=!0x1;['_wsGateway'];['_channel'];static ['_SERVICE']=0xc;constructor(_0x260d9f){super(),this['_documentId']=_0x260d9f;}get['isConnected'](){return this['_isConnected'];}['connect'](_0x3f023a){return this['_isConnected']?Promise['resolve']():this['_connect'](_0x3f023a,new _0x5ceed8(this['_documentId']));}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['fire']('disconnected'),this['stopListening']());}['reconnect'](_0x5ef7f6,_0x14deaf){if(this['isConnected'])throw new _0x1995d2('Cannot\x20reconnect\x20to\x20already\x20connected\x20service.',_0x5ef7f6);return this['_connect'](_0x5ef7f6,new _0x48609f(this['_documentId'],_0x14deaf));}async['updateRevisions'](_0x2d5670,_0xff95d4){const _0x189aa5=_0x25720b['create']({'documentId':this['_documentId'],'requestId':_0xff95d4,'revisions':_0x2d5670}),_0x56e85c=await this['_sendRequest'](_0x25720b['TYPE'],_0x189aa5),{requestId:_0x3673ec}=_0x133f23['decode'](_0x56e85c,_0x35f35c);return _0x3673ec;}async['getRevision'](_0x2eb67a){const _0x2256b2=new _0x4aa15e(this['_documentId'],_0x2eb67a),_0x50a213=await this['_sendRequest'](_0x4aa15e['TYPE'],_0x2256b2);return _0x133f23['decode'](_0x50a213,_0x5ae8dc)['toObject']();}async['_connect'](_0x39e215,_0x5264ca){if(_0x39e215['state']!==WEB_SOCKET_GATEWAY_STATES['CONNECTED'])throw new _0x1995d2('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x39e215);this['_wsGateway']=_0x39e215,this['stopListening'](_0x39e215,'change:state');const _0x51eb61=await _0x39e215['_sendRequest'](0xc,_0x5264ca['constructor']['TYPE'],_0x133f23['encode'](_0x5264ca)),{channel:_0x185076,requestId:_0x596ce8,revisions:_0x42be35}=_0x133f23['decode'](_0x51eb61,_0x2ebe56)['toObject']();return this['listenTo'](_0x39e215,'change:state',(_0x1dc7b1,_0x30893a,_0x40778d)=>this['_onWsGatewayStateChange'](_0x40778d),{'priority':_0x59dfe3['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x39e215,_0x185076),this['_isConnected']=!0x0,this['fire']('connected'),{'revisions':_0x42be35,'requestId':_0x596ce8};}['_connectToChannel'](_0x5ada74,_0x425d24){this['_channel']=_0x5ada74['_getChannel'](RevisionHistoryService['_SERVICE'],_0x425d24),this['_channel']&&this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x25720b['TYPE']),(_0xb2d580,_0x1618d1)=>{const {documentId:_0x5d7c25,requestId:_0x4a1a35,revisions:_0x3b487a}=_0x133f23['decode'](_0x1618d1,_0x25720b)['toObject']();this['fire']('revisionsUpdated',{'documentId':_0x5d7c25,'requestId':_0x4a1a35,'revisionsData':_0x3b487a});});}['_onWsGatewayStateChange'](_0x2c31e8){_0x2c31e8===WEB_SOCKET_GATEWAY_STATES['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x5c7874,_0x5de06b){if(!this['_wsGateway']||!this['_isConnected'])throw new _0x45f96a('Revision\x20History',this);return this['_wsGateway']['_sendRequest'](0xc,_0x5c7874,_0x133f23['encode'](_0x5de06b));}}export default RevisionHistoryService;